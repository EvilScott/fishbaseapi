require File.expand_path 'test_helper.rb'

class FBAppResults < Minitest::Test

  include Rack::Test::Methods

  def app
    FBApp
  end

  $species5 = "{\n  \"count\": 1,\n  \"returned\": 1,\n  \"error\": null,\n  \"data\": [\n    {\n      \"SpecCode\": 5,\n      \"Genus\": \"Orthopristis\",\n      \"Species\": \"chrysoptera\",\n      \"SpeciesRefNo\": 25,\n      \"Author\": \"(Linnaeus, 1766)\",\n      \"FBname\": \"Pigfish\",\n      \"PicPreferredName\": \"Orchr_u0.jpg\",\n      \"PicPreferredNameM\": null,\n      \"PicPreferredNameF\": null,\n      \"PicPreferredNameJ\": null,\n      \"FamCode\": 327,\n      \"Subfamily\": \"Haemulinae\",\n      \"GenCode\": 1542,\n      \"SubGenCode\": null,\n      \"BodyShapeI\": \"short and / or deep\",\n      \"Source\": \"O\",\n      \"Remark\": null,\n      \"TaxIssue\": 0,\n      \"Fresh\": 0,\n      \"Brack\": -1,\n      \"Saltwater\": -1,\n      \"DemersPelag\": \"demersal\",\n      \"AnaCat\": \"oceanodromous\",\n      \"MigratRef\": 51243,\n      \"DepthRangeShallow\": 10,\n      \"DepthRangeDeep\": null,\n      \"DepthRangeRef\": 25,\n      \"DepthRangeComShallow\": null,\n      \"DepthRangeComDeep\": null,\n      \"DepthComRef\": null,\n      \"LongevityWild\": 4.0,\n      \"LongevityWildRef\": 25,\n      \"LongevityCaptive\": null,\n      \"LongevityCapRef\": null,\n      \"Vulnerability\": 50.68,\n      \"Length\": 46.0,\n      \"LTypeMaxM\": \"SL\",\n      \"LengthFemale\": null,\n      \"LTypeMaxF\": null,\n      \"MaxLengthRef\": 25,\n      \"CommonLength\": 30.0,\n      \"LTypeComM\": \"TL\",\n      \"CommonLengthF\": null,\n      \"LTypeComF\": null,\n      \"CommonLengthRef\": 3798,\n      \"Weight\": 900.0,\n      \"WeightFemale\": null,\n      \"MaxWeightRef\": 25,\n      \"Pic\": \"ORCHR_U0\",\n      \"PictureFemale\": null,\n      \"LarvaPic\": null,\n      \"EggPic\": null,\n      \"ImportanceRef\": 181,\n      \"Importance\": \"minor commercial\",\n      \"PriceCateg\": \"low\",\n      \"PriceReliability\": \"Reliable: based on ex-vessel price for this species\",\n      \"Remarks7\": null,\n      \"LandingStatistics\": \"up to 1,000 tons/year\",\n      \"Landings\": \"North Carolina, USA (Area 21)\",\n      \"MainCatchingMethod\": \"seines\",\n      \"II\": \"unspecified seines (SX)\",\n      \"MSeines\": -1,\n      \"MGillnets\": 0,\n      \"MCastnets\": 0,\n      \"MTraps\": -1,\n      \"MSpears\": 0,\n      \"MTrawls\": -1,\n      \"MDredges\": 0,\n      \"MLiftnets\": 0,\n      \"MHooksLines\": -1,\n      \"MOther\": 0,\n      \"UsedforAquaculture\": \"never/rarely\",\n      \"LifeCycle\": null,\n      \"AquacultureRef\": null,\n      \"UsedasBait\": \"usually\",\n      \"BaitRef\": 25,\n      \"Aquarium\": \"public aquariums\",\n      \"AquariumFishII\": \"based mainly on capture\",\n      \"AquariumRef\": 7251,\n      \"GameFish\": 0,\n      \"GameRef\": null,\n      \"Dangerous\": \"harmless\",\n      \"DangerousRef\": null,\n      \"Electrogenic\": \"no special ability\",\n      \"ElectroRef\": null,\n      \"Complete\": null,\n      \"GoogleImage\": -1,\n      \"Comments\": \"Inhabits coastal waters, over sand and mud bottoms.  Forms schools.  Mainly nocturnal and non-burrowing.  Feeds on crustaceans and smaller fishes.  Undergoes seasonal migration as well as local nocturnal-diurnal foraging migrations (Ref. 25).\",\n      \"Profile\": null,\n      \"PD50\": 0.5078,\n      \"Entered\": 1,\n      \"DateEntered\": \"1990-10-17 00:00:00 -0700\",\n      \"Modified\": 393,\n      \"DateModified\": \"2000-09-25 00:00:00 -0700\",\n      \"Expert\": 34,\n      \"DateChecked\": \"1995-08-25 00:00:00 -0700\",\n      \"TS\": null\n    }\n  ]\n}"
  $species = "{\n  \"count\": 32792,\n  \"returned\": 1,\n  \"error\": null,\n  \"data\": [\n    {\n      \"SpecCode\": 16239,\n      \"Genus\": \"Aaptosyax\",\n      \"Species\": \"grypus\",\n      \"SpeciesRefNo\": 10431,\n      \"Author\": \"Rainboth, 1991\",\n      \"FBname\": \"Giant salmon carp\",\n      \"PicPreferredName\": \"Aagry_u0.gif\",\n      \"PicPreferredNameM\": null,\n      \"PicPreferredNameF\": null,\n      \"PicPreferredNameJ\": null,\n      \"FamCode\": 122,\n      \"Subfamily\": \"No subfamily\",\n      \"GenCode\": 10273,\n      \"SubGenCode\": null,\n      \"BodyShapeI\": \"fusiform / normal\",\n      \"Source\": \"O\",\n      \"Remark\": null,\n      \"TaxIssue\": 12,\n      \"Fresh\": -1,\n      \"Brack\": 0,\n      \"Saltwater\": 0,\n      \"DemersPelag\": \"pelagic\",\n      \"AnaCat\": \"potamodromous\",\n      \"MigratRef\": 51243,\n      \"DepthRangeShallow\": null,\n      \"DepthRangeDeep\": null,\n      \"DepthRangeRef\": null,\n      \"DepthRangeComShallow\": null,\n      \"DepthRangeComDeep\": null,\n      \"DepthComRef\": null,\n      \"LongevityWild\": null,\n      \"LongevityWildRef\": null,\n      \"LongevityCaptive\": null,\n      \"LongevityCapRef\": null,\n      \"Vulnerability\": 80.31,\n      \"Length\": 130.0,\n      \"LTypeMaxM\": \"SL\",\n      \"LengthFemale\": null,\n      \"LTypeMaxF\": null,\n      \"MaxLengthRef\": 9497,\n      \"CommonLength\": null,\n      \"LTypeComM\": null,\n      \"CommonLengthF\": null,\n      \"LTypeComF\": null,\n      \"CommonLengthRef\": null,\n      \"Weight\": 30000.0,\n      \"WeightFemale\": null,\n      \"MaxWeightRef\": 9497,\n      \"Pic\": null,\n      \"PictureFemale\": null,\n      \"LarvaPic\": null,\n      \"EggPic\": null,\n      \"ImportanceRef\": 10431,\n      \"Importance\": null,\n      \"PriceCateg\": \"unknown\",\n      \"PriceReliability\": null,\n      \"Remarks7\": null,\n      \"LandingStatistics\": \" \",\n      \"Landings\": null,\n      \"MainCatchingMethod\": \"gillnets\",\n      \"II\": \" \",\n      \"MSeines\": -1,\n      \"MGillnets\": -1,\n      \"MCastnets\": -1,\n      \"MTraps\": 0,\n      \"MSpears\": 0,\n      \"MTrawls\": 0,\n      \"MDredges\": 0,\n      \"MLiftnets\": 0,\n      \"MHooksLines\": -1,\n      \"MOther\": -1,\n      \"UsedforAquaculture\": \"never/rarely\",\n      \"LifeCycle\": \" \",\n      \"AquacultureRef\": null,\n      \"UsedasBait\": \"never/rarely\",\n      \"BaitRef\": null,\n      \"Aquarium\": \"never/rarely\",\n      \"AquariumFishII\": \" \",\n      \"AquariumRef\": null,\n      \"GameFish\": 0,\n      \"GameRef\": null,\n      \"Dangerous\": \"harmless\",\n      \"DangerousRef\": null,\n      \"Electrogenic\": \"no special ability\",\n      \"ElectroRef\": null,\n      \"Complete\": null,\n      \"GoogleImage\": -1,\n      \"Comments\": \"Inhabits mainstreams of middle reaches in deep rocky rapids.  Juveniles occur in tributaries (Ref. 58784). A large fast-swimming predator, feeding on fish of the middle and the upper water levels.  Although most common along the Thai-Lao border at the mouth of the Mun River, its numbers have drastically decreased in recent years.  This is perhaps due to dam construction or excessive gill netting, to which active pursuit predators, like this species, are particularly vulnerable (Ref. 12693).  Undertakes upstream migration at the same time as <i>Probarbus</i> sp. in December-February (Ref. 37770) which may be related to spawning activity (Ref. 9497).  Attains over 30 kg (Ref. 9497).\",\n      \"Profile\": null,\n      \"PD50\": 1.0,\n      \"Entered\": 113,\n      \"DateEntered\": \"1996-01-12 00:00:00 -0800\",\n      \"Modified\": 1016,\n      \"DateModified\": \"2013-07-24 00:00:00 -0700\",\n      \"Expert\": null,\n      \"DateChecked\": null,\n      \"TS\": null\n    }\n  ]\n}"

  def test_result_by_id
    get '/species/5'
    assert last_response.ok?
    assert $species5, last_response.body
  end

  def test_result_no_id
    get '/species?limit=1'
    assert last_response.ok?
    assert $species, last_response.body
  end

end
