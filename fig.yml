redis:
  image: redis:latest

geoip:
  image: allingeek/docker-freegeoip

mysql:
  image: mysql:latest
  volumes: 
    - ${HOME}/data/fishbase:/var/lib/mysql
  environment: 
    MYSQL_ROOT_PASSWORD: root

logstash:
  image: pblittle/docker-logstash:latest
    volumes:
      - /var/log/fishbase
      - ${PWD}/logstashconf:/opt/logstash/conf.d 
#  environment:
#    LOGSTASH_CONFIG_URL: https://raw.githubusercontent.com/ropensci/fishbaseapi/master/logstash.conf

api:
  image: ropensci/fishbaseapi:latest
  links:
    - mysql
    - redis
    - geoip
  volumes_from: 
    - logstash

nginx:
  image: nginx:latest
  ports:
   - "80:80"
   - "9292:9292"
   - "9200:9200"
  links:
    - logstash
    - api
  volumes:
    - ${PWD}/nginx.conf:/etc/nginx/nginx.conf
    - ${PWD}/.htpasswd:/etc/nginx/.htpasswd
    - ${PWD}/es.crt:/etc/ssl/certs/es.crt
    - ${PWD}/es.key:/etc/ssl/private/es.key
